/**
 * ghostHunter - 0.3.1
 * Copyright (C) 2014 Jamal Neufeld (jamal@i11u.me)
 * MIT Licensed
 * @license
 */
(function(c){!function(){var d=function(f){var g=new d.Index;return g.pipeline.add(d.trimmer,d.stopWordFilter,d.stemmer),f&&f.call(g,g),g};d.version="0.7.0",d.utils={},d.utils.warn=function(e){return function(f){e.console&&console.warn&&console.warn(f)}}(this),d.utils.asString=function(e){return void 0===e||null===e?"":e.toString()},d.EventEmitter=function(){this.events={}},d.EventEmitter.prototype.addListener=function(){var f=Array.prototype.slice.call(arguments),g=f.pop(),h=f;if("function"!=typeof g){throw new TypeError("last argument must be a function")}h.forEach(function(e){this.hasHandler(e)||(this.events[e]=[]),this.events[e].push(g)},this)},d.EventEmitter.prototype.removeListener=function(f,g){if(this.hasHandler(f)){var h=this.events[f].indexOf(g);this.events[f].splice(h,1),this.events[f].length||delete this.events[f]}},d.EventEmitter.prototype.emit=function(f){if(this.hasHandler(f)){var g=Array.prototype.slice.call(arguments,1);this.events[f].forEach(function(e){e.apply(void 0,g)})}},d.EventEmitter.prototype.hasHandler=function(e){return e in this.events},d.tokenizer=function(f){return arguments.length&&null!=f&&void 0!=f?Array.isArray(f)?f.map(function(g){return d.utils.asString(g).toLowerCase()}):f.toString().trim().toLowerCase().split(d.tokenizer.seperator):[]},d.tokenizer.seperator=/[\s\-]+/,d.tokenizer.load=function(f){var g=this.registeredFunctions[f];if(!g){throw new Error("Cannot load un-registered function: "+f)}return g},d.tokenizer.label="default",d.tokenizer.registeredFunctions={"default":d.tokenizer},d.tokenizer.registerFunction=function(f,g){g in this.registeredFunctions&&d.utils.warn("Overwriting existing tokenizer: "+g),f.label=g,this.registeredFunctions[g]=f},d.Pipeline=function(){this._stack=[]},d.Pipeline.registeredFunctions={},d.Pipeline.registerFunction=function(f,g){g in this.registeredFunctions&&d.utils.warn("Overwriting existing registered function: "+g),f.label=g,d.Pipeline.registeredFunctions[f.label]=f},d.Pipeline.warnIfFunctionNotRegistered=function(f){var g=f.label&&f.label in this.registeredFunctions;g||d.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",f)},d.Pipeline.load=function(f){var g=new d.Pipeline;return f.forEach(function(j){var h=d.Pipeline.registeredFunctions[j];if(!h){throw new Error("Cannot load un-registered function: "+j)}g.add(h)}),g},d.Pipeline.prototype.add=function(){var f=Array.prototype.slice.call(arguments);f.forEach(function(g){d.Pipeline.warnIfFunctionNotRegistered(g),this._stack.push(g)},this)},d.Pipeline.prototype.after=function(g,h){d.Pipeline.warnIfFunctionNotRegistered(h);var f=this._stack.indexOf(g);if(-1==f){throw new Error("Cannot find existingFn")}f+=1,this._stack.splice(f,0,h)},d.Pipeline.prototype.before=function(g,h){d.Pipeline.warnIfFunctionNotRegistered(h);var f=this._stack.indexOf(g);if(-1==f){throw new Error("Cannot find existingFn")}this._stack.splice(f,0,h)},d.Pipeline.prototype.remove=function(f){var g=this._stack.indexOf(f);-1!=g&&this._stack.splice(g,1)},d.Pipeline.prototype.run=function(g){for(var k=[],m=g.length,f=this._stack.length,j=0;m>j;j++){for(var l=g[j],h=0;f>h&&(l=this._stack[h](l,j,g),void 0!==l&&""!==l);h++){}void 0!==l&&""!==l&&k.push(l)}return k},d.Pipeline.prototype.reset=function(){this._stack=[]},d.Pipeline.prototype.toJSON=function(){return this._stack.map(function(f){return d.Pipeline.warnIfFunctionNotRegistered(f),f.label})},d.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},d.Vector.Node=function(f,g,h){this.idx=f,this.val=g,this.next=h},d.Vector.prototype.insert=function(h,k){this._magnitude=void 0;var f=this.list;if(!f){return this.list=new d.Vector.Node(h,k,f),this.length++}if(h<f.idx){return this.list=new d.Vector.Node(h,k,f),this.length++}for(var g=f,j=f.next;void 0!=j;){if(h<j.idx){return g.next=new d.Vector.Node(h,k,j),this.length++}g=j,j=j.next}return g.next=new d.Vector.Node(h,k,j),this.length++},d.Vector.prototype.magnitude=function(){if(this._magnitude){return this._magnitude}for(var f,g=this.list,h=0;g;){f=g.val,h+=f*f,g=g.next}return this._magnitude=Math.sqrt(h)},d.Vector.prototype.dot=function(g){for(var h=this.list,j=g.list,f=0;h&&j;){h.idx<j.idx?h=h.next:h.idx>j.idx?j=j.next:(f+=h.val*j.val,h=h.next,j=j.next)}return f},d.Vector.prototype.similarity=function(e){return this.dot(e)/(this.magnitude()*e.magnitude())},d.SortedSet=function(){this.length=0,this.elements=[]},d.SortedSet.load=function(f){var g=new this;return g.elements=f,g.length=f.length,g},d.SortedSet.prototype.add=function(){var f,g;for(f=0;f<arguments.length;f++){g=arguments[f],~this.indexOf(g)||this.elements.splice(this.locationFor(g),0,g)}this.length=this.elements.length},d.SortedSet.prototype.toArray=function(){return this.elements.slice()},d.SortedSet.prototype.map=function(f,g){return this.elements.map(f,g)},d.SortedSet.prototype.forEach=function(f,g){return this.elements.forEach(f,g)},d.SortedSet.prototype.indexOf=function(g){for(var j=0,l=this.elements.length,f=l-j,h=j+Math.floor(f/2),k=this.elements[h];f>1;){if(k===g){return h}g>k&&(j=h),k>g&&(l=h),f=l-j,h=j+Math.floor(f/2),k=this.elements[h]}return k===g?h:-1},d.SortedSet.prototype.locationFor=function(g){for(var j=0,l=this.elements.length,f=l-j,h=j+Math.floor(f/2),k=this.elements[h];f>1;){g>k&&(j=h),k>g&&(l=h),f=l-j,h=j+Math.floor(f/2),k=this.elements[h]}return k>g?h:g>k?h+1:void 0},d.SortedSet.prototype.intersect=function(m){for(var q=new d.SortedSet,g=0,l=0,p=this.length,k=m.length,f=this.elements,j=m.elements;;){if(g>p-1||l>k-1){break}f[g]!==j[l]?f[g]<j[l]?g++:f[g]>j[l]&&l++:(q.add(f[g]),g++,l++)}return q},d.SortedSet.prototype.clone=function(){var f=new d.SortedSet;return f.elements=this.toArray(),f.length=f.elements.length,f},d.SortedSet.prototype.union=function(g){var j,l,f;this.length>=g.length?(j=this,l=g):(j=g,l=this),f=j.clone();for(var h=0,k=l.toArray();h<k.length;h++){f.add(k[h])}return f},d.SortedSet.prototype.toJSON=function(){return this.toArray()},d.Index=function(){this._fields=[],this._ref="id",this.pipeline=new d.Pipeline,this.documentStore=new d.Store,this.tokenStore=new d.TokenStore,this.corpusTokens=new d.SortedSet,this.eventEmitter=new d.EventEmitter,this.tokenizerFn=d.tokenizer,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},d.Index.prototype.on=function(){var e=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,e)},d.Index.prototype.off=function(f,g){return this.eventEmitter.removeListener(f,g)},d.Index.load=function(f){f.version!==d.version&&d.utils.warn("version mismatch: current "+d.version+" importing "+f.version);var g=new this;return g._fields=f.fields,g._ref=f.ref,g.tokenizer=d.tokenizer.load(f.tokenizer),g.documentStore=d.Store.load(f.documentStore),g.tokenStore=d.TokenStore.load(f.tokenStore),g.corpusTokens=d.SortedSet.load(f.corpusTokens),g.pipeline=d.Pipeline.load(f.pipeline),g},d.Index.prototype.field=function(f,g){var g=g||{},h={name:f,boost:g.boost||1};return this._fields.push(h),this},d.Index.prototype.ref=function(e){return this._ref=e,this},d.Index.prototype.tokenizer=function(f){var g=f.label&&f.label in d.tokenizer.registeredFunctions;return g||d.utils.warn("Function is not a registered tokenizer. This may cause problems when serialising the index"),this.tokenizerFn=f,this},d.Index.prototype.add=function(x,m){var t={},g=new d.SortedSet,k=x[this._ref],m=void 0===m?!0:m;this._fields.forEach(function(e){var i=this.pipeline.run(this.tokenizerFn(x[e.name]));t[e.name]=i;for(var h=0;h<i.length;h++){var f=i[h];g.add(f),this.corpusTokens.add(f)}},this),this.documentStore.set(k,g);for(var C=0;C<g.length;C++){for(var A=g.elements[C],v=0,B=0;B<this._fields.length;B++){var q=this._fields[B],z=t[q.name],w=z.length;if(w){for(var y=0,j=0;w>j;j++){z[j]===A&&y++}v+=y/w*q.boost}}this.tokenStore.add(A,{ref:k,tf:v})}m&&this.eventEmitter.emit("add",x,this)},d.Index.prototype.remove=function(g,h){var j=g[this._ref],h=void 0===h?!0:h;if(this.documentStore.has(j)){var f=this.documentStore.get(j);this.documentStore.remove(j),f.forEach(function(e){this.tokenStore.remove(e,j)},this),h&&this.eventEmitter.emit("remove",g,this)}},d.Index.prototype.update=function(f,g){var g=void 0===g?!0:g;this.remove(f,!1),this.add(f,!1),g&&this.eventEmitter.emit("update",f,this)},d.Index.prototype.idf=function(g){var h="@"+g;if(Object.prototype.hasOwnProperty.call(this._idfCache,h)){return this._idfCache[h]}var j=this.tokenStore.count(g),f=1;return j>0&&(f=1+Math.log(this.documentStore.length/j)),this._idfCache[h]=f},d.Index.prototype.search=function(k){var m=this.pipeline.run(this.tokenizerFn(k)),g=new d.Vector,j=[],l=this._fields.reduce(function(i,n){return i+n.boost},0),h=m.some(function(e){return this.tokenStore.has(e)},this);if(!h){return[]}m.forEach(function(r,t,q){var i=1/q.length*this._fields.length*l,p=this,o=this.tokenStore.expand(r).reduce(function(y,e){var x=p.corpusTokens.indexOf(e),F=p.idf(e),E=1,z=new d.SortedSet;if(e!==r){var C=Math.max(3,e.length-r.length);E=1/Math.log(C)}x>-1&&g.insert(x,i*F*E);for(var A=p.tokenStore.get(e),B=Object.keys(A),w=B.length,D=0;w>D;D++){z.add(A[B[D]].ref)}return y.union(z)},new d.SortedSet);j.push(o)},this);var f=j.reduce(function(i,n){return i.intersect(n)});return f.map(function(e){return{ref:e,score:g.similarity(this.documentVector(e))}},this).sort(function(i,n){return n.score-i.score})},d.Index.prototype.documentVector=function(m){for(var q=this.documentStore.get(m),g=q.length,l=new d.Vector,p=0;g>p;p++){var k=q.elements[p],f=this.tokenStore.get(k)[m].tf,j=this.idf(k);l.insert(this.corpusTokens.indexOf(k),f*j)}return l},d.Index.prototype.toJSON=function(){return{version:d.version,fields:this._fields,ref:this._ref,tokenizer:this.tokenizerFn.label,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},d.Index.prototype.use=function(f){var g=Array.prototype.slice.call(arguments,1);g.unshift(this),f.apply(this,g)},d.Store=function(){this.store={},this.length=0},d.Store.load=function(f){var g=new this;return g.length=f.length,g.store=Object.keys(f.store).reduce(function(h,e){return h[e]=d.SortedSet.load(f.store[e]),h},{}),g},d.Store.prototype.set=function(f,g){this.has(f)||this.length++,this.store[f]=g},d.Store.prototype.get=function(e){return this.store[e]},d.Store.prototype.has=function(e){return e in this.store},d.Store.prototype.remove=function(e){this.has(e)&&(delete this.store[e],this.length--)},d.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},d.stemmer=function(){var M={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},ad={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},V="[^aeiou]",Z="[aeiouy]",Q=V+"[^aeiouy]*",U=Z+"[aeiou]*",N="^("+Q+")?"+U+Q,ah="^("+Q+")?"+U+Q+"("+U+")?$",aa="^("+Q+")?"+U+Q+U+Q,K="^("+Q+")?"+Z,X=new RegExp(N),af=new RegExp(aa),ac=new RegExp(ah),ae=new RegExp(K),R=/^(.+?)(ss|i)es$/,I=/^(.+?)([^s])s$/,ab=/^(.+?)eed$/,W=/^(.+?)(ed|ing)$/,D=/.$/,q=/(at|bl|iz)$/,H=new RegExp("([^aeiouylsz])\\1$"),Y=new RegExp("^"+Q+Z+"[^aeiouwxy]$"),G=/^(.+?[^aeiou])y$/,ag=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,L=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,J=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,ai=/^(.+?)(s|t)(ion)$/,C=/^(.+?)e$/,B=/ll$/,A=new RegExp("^"+Q+Z+"[^aeiouwxy]$"),j=function(g){var l,e,f,v,p,m,t;if(g.length<3){return g}if(f=g.substr(0,1),"y"==f&&(g=f.toUpperCase()+g.substr(1)),v=R,p=I,v.test(g)?g=g.replace(v,"$1$2"):p.test(g)&&(g=g.replace(p,"$1$2")),v=ab,p=W,v.test(g)){var k=v.exec(g);v=X,v.test(k[1])&&(v=D,g=g.replace(v,""))}else{if(p.test(g)){var k=p.exec(g);l=k[1],p=ae,p.test(l)&&(g=l,p=q,m=H,t=Y,p.test(g)?g+="e":m.test(g)?(v=D,g=g.replace(v,"")):t.test(g)&&(g+="e"))}}if(v=G,v.test(g)){var k=v.exec(g);l=k[1],g=l+"i"}if(v=ag,v.test(g)){var k=v.exec(g);l=k[1],e=k[2],v=X,v.test(l)&&(g=l+M[e])}if(v=L,v.test(g)){var k=v.exec(g);l=k[1],e=k[2],v=X,v.test(l)&&(g=l+ad[e])}if(v=J,p=ai,v.test(g)){var k=v.exec(g);l=k[1],v=af,v.test(l)&&(g=l)}else{if(p.test(g)){var k=p.exec(g);l=k[1]+k[2],p=af,p.test(l)&&(g=l)}}if(v=C,v.test(g)){var k=v.exec(g);l=k[1],v=af,p=ac,m=A,(v.test(l)||p.test(l)&&!m.test(l))&&(g=l)}return v=B,p=af,v.test(g)&&p.test(g)&&(v=D,g=g.replace(v,"")),"y"==f&&(g=f.toLowerCase()+g.substr(1)),g};return j}(),d.Pipeline.registerFunction(d.stemmer,"stemmer"),d.generateStopWordFilter=function(f){var g=f.reduce(function(h,i){return h[i]=i,h},{});return function(e){return e&&g[e]!==e?e:void 0}},d.stopWordFilter=d.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),d.Pipeline.registerFunction(d.stopWordFilter,"stopWordFilter"),d.trimmer=function(e){return e.replace(/^\W+/,"").replace(/\W+$/,"")},d.Pipeline.registerFunction(d.trimmer,"trimmer"),d.TokenStore=function(){this.root={docs:{}},this.length=0},d.TokenStore.load=function(f){var g=new this;return g.root=f.root,g.length=f.length,g},d.TokenStore.prototype.add=function(g,j,k){var k=k||this.root,f=g.charAt(0),h=g.slice(1);return f in k||(k[f]={docs:{}}),0===h.length?(k[f].docs[j.ref]=j,void (this.length+=1)):this.add(h,j,k[f])},d.TokenStore.prototype.has=function(f){if(!f){return !1}for(var g=this.root,h=0;h<f.length;h++){if(!g[f.charAt(h)]){return !1}g=g[f.charAt(h)]}return !0},d.TokenStore.prototype.getNode=function(f){if(!f){return{}}for(var g=this.root,h=0;h<f.length;h++){if(!g[f.charAt(h)]){return{}}g=g[f.charAt(h)]}return g},d.TokenStore.prototype.get=function(f,g){return this.getNode(f,g).docs||{}},d.TokenStore.prototype.count=function(f,g){return Object.keys(this.get(f,g)).length},d.TokenStore.prototype.remove=function(g,h){if(g){for(var j=this.root,f=0;f<g.length;f++){if(!(g.charAt(f) in j)){return}j=j[g.charAt(f)]}delete j.docs[h]}},d.TokenStore.prototype.expand=function(g,h){var j=this.getNode(g),f=j.docs||{},h=h||[];return Object.keys(f).length&&h.push(g),Object.keys(j).forEach(function(e){"docs"!==e&&h.concat(this.expand(g+e,h))},this),h},d.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},function(f,g){"function"==typeof define&&define.amd?define(g):"object"==typeof exports?module.exports=g():f.lunr=g()}(this,function(){return d})}();c.fn.ghostHunter=function(d){var e=c.extend({},c.fn.ghostHunter.defaults,d);if(e.results){b.init(this,e);return b}};c.fn.ghostHunter.defaults={results:false,onKeyUp:false,result_template:"<a href='{{link}}'><p><h2>{{title}}</h2><h4>{{prettyPubDate}}</h4></p></a>",info_template:"<p>Number of posts found: {{amount}}</p>",displaySearchInfo:true,zeroResultsInfo:true,before:false,lunr:false,onComplete:false};var a=function(f){var g=new Date(f);var e=["January","February","March","April","May","June","July","August","September","October","November","December"];return g.getDate()+" "+e[g.getMonth()]+" "+g.getFullYear()};var b={isInit:false,init:function(f,e){var d=this;this.target=f;this.results=e.results;this.blogData={};this.result_template=e.result_template;this.info_template=e.info_template;this.zeroResultsInfo=e.zeroResultsInfo;this.displaySearchInfo=e.displaySearchInfo;this.before=e.before;this.lunr=e.lunr;this.onComplete=e.onComplete;this.index=lunr(function(g){if(d.lunr&&d.lunr.call(this,g)){return}this.field("title",{boost:10});this.field("description");this.field("link");this.field("markdown",{boost:5});this.field("pubDate");this.field("tag");this.ref("id")});f.focus(function(){d.loadAPI()});f.closest("form").submit(function(g){g.preventDefault();d.find(f.val())});if(e.onKeyUp){d.loadAPI();f.keyup(function(){d.find(f.val())})}},loadAPI:function(){if(this.isInit){return false}var e=this.index,d=this.blogData;c.get(ghost.url.api("posts",{limit:"all",include:"tags"})).done(function(f){searchData=f.posts;searchData.forEach(function(g){var h=g.tags.map(function(l){return l.name});var i=h.join(", ");if(i.length<1){i="undefined"}var k={id:String(g.id),title:String(g.title),description:String(g.meta_description),markdown:String(g.markdown),pubDate:String(g.created_at),tag:i,link:String(g.url)};k.prettyPubDate=a(k.pubDate);var j=a(k.pubDate);e.add(k);d[g.id]={title:g.title,description:g.meta_description,pubDate:j,link:g.url}})});this.isInit=true},find:function(j){var d=this.index.search(j);var h=c(this.results);var f=[];h.empty();if(this.before){this.before()}if(this.zeroResultsInfo||d.length>0){if(this.displaySearchInfo){h.append(this.format(this.info_template,{amount:d.length}))}}for(var g=0;g<d.length;g++){var k=d[g].ref;var e=this.blogData[k];h.append(this.format(this.result_template,e));f.push(e)}if(this.onComplete){this.onComplete(f)}},clear:function(){c(this.results).empty();this.target.val("")},format:function(e,f){return e.replace(/{{([^{}]*)}}/g,function(g,d){var h=f[d];return typeof h==="string"||typeof h==="number"?h:g})}}})(jQuery);
